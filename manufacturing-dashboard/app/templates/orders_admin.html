{% extends "base.html" %}
{% block content %}
<h2>Admin: sort and update orders</h2>

<form method="get">
  <label>Sort by</label>
  <select name="sort">
    <option value="Order_Date" {% if sort=='Order_Date' %}selected{% endif %}>Order_Date</option>
    <option value="Order_Price" {% if sort=='Order_Price' %}selected{% endif %}>Order_Price</option>
    <option value="Order_Quantity" {% if sort=='Order_Quantity' %}selected{% endif %}>Order_Quantity</option>
    <option value="Order_Status" {% if sort=='Order_Status' %}selected{% endif %}>Order_Status</option>
    <option value="Account_ID" {% if sort=='Account_ID' %}selected{% endif %}>Account_ID</option>
  </select>

  <label>Direction</label>
  <select name="dir">
    <option value="asc" {% if direction=='asc' %}selected{% endif %}>asc</option>
    <option value="desc" {% if direction=='desc' %}selected{% endif %}>desc</option>
  </select>

  <label>Status filter</label>
  <select name="status">
    <option value="">(all)</option>
    {% for s in ['Pending','Processing','Shipped','Completed','Cancelled'] %}
      <option value="{{ s }}" {% if status==s %}selected{% endif %}>{{ s }}</option>
    {% endfor %}
  </select>

  <button type="submit">Apply</button>
</form>

<table>
  <thead>
    <tr>
      <th>Order_ID</th><th>Account</th><th>Part</th><th>Date</th><th>Status</th><th>Qty</th><th>Price</th><th>Update</th>
    </tr>
  </thead>
  <tbody>
    {% for o in orders %}
    <tr>
      <td>{{ o.Order_ID }}</td>
      <td>{{ users_by_id[o.Account_ID].Account_Username }}</td>
      <td>{% if o.Part_ID %}{{ parts_by_id[o.Part_ID].Part_Name }}{% else %}-{% endif %}</td>
      <td>{{ o.Order_Date }}</td>
      <td>{{ o.Order_Status }}</td>
      <td>{{ o.Order_Quantity }}</td>
      <td>{{ "%.2f"|format(o.Order_Price) }}</td>
      <td>
        <form method="post" action="{{ url_for('admin_order_update', order_id=o.Order_ID) }}">
          <select name="Order_Status">
            {% for s in ['Pending','Processing','Shipped','Completed','Cancelled'] %}
              <option value="{{ s }}" {% if o.Order_Status==s %}selected{% endif %}>{{ s }}</option>
            {% endfor %}
          </select>
          <input type="number" name="Order_Quantity" min="1" value="{{ o.Order_Quantity }}">
          <input type="number" step="0.01" name="Order_Price" value="{{ o.Order_Price }}">
          <select name="Part_ID">
            <option value="">-- None --</option>
            {% for p in parts_by_id.values() %}
              <option value="{{ p.Part_ID }}" {% if o.Part_ID==p.Part_ID %}selected{% endif %}>{{ p.Part_Name }}</option>
            {% endfor %}
          </select>
          <button type="submit">Save</button>
        </form>
      </td>
    </tr>
    {% else %}
    <tr><td colspan="8">No orders.</td></tr>
    {% endfor %}
  </tbody>
</table>
{% endblock %}
